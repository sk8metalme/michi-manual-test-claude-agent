# Requirements Document

## Project Description (Input)
Java+Springbootのオニオンアーキテクチャのテトリスwebアプリ

## Introduction
本ドキュメントは、Java + Spring Bootフレームワークを使用し、オニオンアーキテクチャを適用したテトリスWebアプリケーションの要件を定義します。クラシックなテトリスゲームの体験をブラウザで提供し、保守性と拡張性の高いアーキテクチャを実現します。

## Requirements

### Requirement 1: ゲームプレイ - テトリミノ操作
**Objective:** プレイヤーとして、テトリミノ（ブロック）を自由に操作できることで、ゲームを楽しめる

#### Acceptance Criteria
1. When プレイヤーが左矢印キーを押下, the テトリスアプリ shall テトリミノを1マス左に移動する
2. When プレイヤーが右矢印キーを押下, the テトリスアプリ shall テトリミノを1マス右に移動する
3. When プレイヤーが上矢印キーを押下, the テトリスアプリ shall テトリミノを時計回りに90度回転する
4. When プレイヤーが下矢印キーを押下, the テトリスアプリ shall テトリミノの落下速度を通常の10倍に加速する
5. When プレイヤーがスペースキーを押下, the テトリスアプリ shall テトリミノを即座に底まで落下させる（ハードドロップ）
6. If テトリミノの移動先に障害物が存在する, then the テトリスアプリ shall 移動を無効化し現在位置を維持する
7. If テトリミノの回転後の位置に障害物が存在する, then the テトリスアプリ shall 回転を無効化し現在の向きを維持する

### Requirement 2: ゲームプレイ - テトリミノ自動落下
**Objective:** プレイヤーとして、テトリミノが自動的に落下することで、継続的なゲーム進行を体験できる

#### Acceptance Criteria
1. When ゲームが開始される, the テトリスアプリ shall ランダムなテトリミノをフィールド上部中央に出現させる
2. While ゲームが進行中である, the テトリスアプリ shall テトリミノを一定間隔（初期値1秒）で1マス下に自動落下させる
3. When テトリミノがフィールド底部または他のブロックに接触, the テトリスアプリ shall テトリミノを固定しフィールドに配置する
4. When テトリミノが固定される, the テトリスアプリ shall 新しいランダムなテトリミノをフィールド上部中央に出現させる
5. The テトリスアプリ shall 7種類の標準テトリミノ（I, O, T, S, Z, J, L）をサポートする

### Requirement 3: ゲームロジック - ライン消去とスコア
**Objective:** プレイヤーとして、ラインを揃えて消去しスコアを獲得することで、ゲームの達成感を得られる

#### Acceptance Criteria
1. When 横一列がブロックで完全に埋まる, the テトリスアプリ shall そのラインを消去する
2. When ラインが消去される, the テトリスアプリ shall 消去されたライン上部のすべてのブロックを1マス下に落下させる
3. When 1ラインが消去される, the テトリスアプリ shall スコアに100点を加算する
4. When 2ライン同時に消去される, the テトリスアプリ shall スコアに300点を加算する
5. When 3ライン同時に消去される, the テトリスアプリ shall スコアに500点を加算する
6. When 4ライン同時に消去される（テトリス）, the テトリスアプリ shall スコアに800点を加算する
7. The テトリスアプリ shall 現在のスコアをリアルタイムで画面に表示する

### Requirement 4: ゲームロジック - レベルと難易度
**Objective:** プレイヤーとして、ゲーム進行に伴い難易度が上昇することで、継続的なチャレンジを体験できる

#### Acceptance Criteria
1. The テトリスアプリ shall ゲーム開始時のレベルを1に設定する
2. When 累計消去ライン数が10ラインに到達, the テトリスアプリ shall レベルを1増加させる
3. When レベルが上昇, the テトリスアプリ shall テトリミノの落下速度を10%増加させる
4. The テトリスアプリ shall 現在のレベルと累計消去ライン数を画面に表示する
5. The テトリスアプリ shall レベル10を最大とし、それ以降は落下速度を固定する

### Requirement 5: ゲームロジック - ゲームオーバーと再スタート
**Objective:** プレイヤーとして、ゲーム終了条件を明確に理解し、簡単に再プレイできる

#### Acceptance Criteria
1. If 新しいテトリミノの出現位置に既存のブロックが存在する, then the テトリスアプリ shall ゲームオーバー状態に遷移する
2. When ゲームオーバーが発生, the テトリスアプリ shall 「ゲームオーバー」メッセージと最終スコアを表示する
3. When ゲームオーバー画面が表示される, the テトリスアプリ shall 「再スタート」ボタンを表示する
4. When プレイヤーが「再スタート」ボタンをクリック, the テトリスアプリ shall ゲーム状態を初期化し新しいゲームを開始する

### Requirement 6: ユーザーインターフェース - ゲーム画面
**Objective:** プレイヤーとして、直感的で見やすいゲーム画面で快適にプレイできる

#### Acceptance Criteria
1. The テトリスアプリ shall 10列×20行のゲームフィールドを表示する
2. The テトリスアプリ shall 各ブロックを異なる色で視覚的に区別可能に表示する
3. The テトリスアプリ shall 次に出現するテトリミノ（ネクストブロック）をプレビュー表示する
4. The テトリスアプリ shall テトリミノのゴースト（落下予測位置）を半透明で表示する
5. The テトリスアプリ shall ブラウザウィンドウサイズに応じてゲーム画面をレスポンシブに調整する
6. The テトリスアプリ shall PC（デスクトップ）ブラウザでの動作をサポートする

### Requirement 7: データ永続化 - スコア保存
**Objective:** プレイヤーとして、自分のスコア記録を保存し過去の成績を確認できる

#### Acceptance Criteria
1. When ゲームオーバーが発生, the テトリスアプリ shall 最終スコア、レベル、消去ライン数をデータベースに保存する
2. When スコアを保存, the テトリスアプリ shall タイムスタンプを付与する
3. The テトリスアプリ shall スコア履歴画面で過去10件のプレイ記録を表示する
4. The テトリスアプリ shall 履歴スコアを降順（高スコア順）でソートして表示する

### Requirement 8: アーキテクチャ - オニオンアーキテクチャ適用
**Objective:** 開発チームとして、保守性と拡張性の高いアーキテクチャを実現する

#### Acceptance Criteria
1. The テトリスアプリ shall ドメイン層（Domain Layer）にゲームロジックとビジネスルールを配置する
2. The テトリスアプリ shall アプリケーション層（Application Layer）にユースケース実装を配置する
3. The テトリスアプリ shall インフラストラクチャ層（Infrastructure Layer）にデータベースアクセスと外部システム連携を配置する
4. The テトリスアプリ shall プレゼンテーション層（Presentation Layer）にREST API実装を配置する
5. The テトリスアプリ shall ドメイン層が外部層（インフラストラクチャ、プレゼンテーション）に依存しないよう依存性逆転の原則を適用する
6. The テトリスアプリ shall 各層間の通信にインターフェース（ポート）とその実装（アダプター）を使用する

### Requirement 9: 技術要件 - Spring Boot実装
**Objective:** 開発チームとして、Spring Bootフレームワークを活用し効率的に開発する

#### Acceptance Criteria
1. The テトリスアプリ shall Java 17以上を使用する
2. The テトリスアプリ shall Spring Boot 3.x系を使用する
3. The テトリスアプリ shall Spring Data JPAを使用してデータベースアクセスを実装する
4. The テトリスアプリ shall Spring Webを使用してREST APIを実装する
5. The テトリスアプリ shall 組み込みH2データベースまたはPostgreSQLをサポートする
6. The テトリスアプリ shall Gradleをビルドツールとして使用する

### Requirement 10: 非機能要件 - パフォーマンスと品質
**Objective:** プレイヤーとして、快適でストレスのないゲーム体験を得られる

#### Acceptance Criteria
1. The テトリスアプリ shall ブロック移動・回転操作のレスポンスタイムを100ミリ秒以内とする
2. The テトリスアプリ shall ゲーム画面の描画を毎秒60フレーム（60 FPS）で実行する
3. The テトリスアプリ shall 同時に5ユーザーのゲームセッションをサポートする
4. The テトリスアプリ shall 単体テストのコードカバレッジを80%以上とする
5. The テトリスアプリ shall エラー発生時に適切なエラーメッセージをユーザーに表示する
6. The テトリスアプリ shall アプリケーションログに全エラーとゲームイベントを記録する
